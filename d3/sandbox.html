<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Sandbox with Jasmine</title>
</head>
  <link rel="shortcut icon" type="image/png" href="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.0.0/jasmine_favicon.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.0.0/jasmine.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.0.0/jasmine.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.0.0/jasmine-html.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.0.0/console.js"></script>

  <body>
    <div id="HTMLReporter" class="jasmine_reporter"></div>
  </body>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/d3.hexbin.v0.min.js"></script>

  <script>

    //Callback triggered by browser


    d3.custom = {};

    d3.custom.paddoom = function module() {
      var width = 960;
      var height = 500;
      var radius = 50;
      var svg;

      function exports(_dataset) {

        if (!svg) {
          svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
        };

        svg.append("path")
            .attr("class", "mesh")
            .attr("d", d3.hexbin()
              .size([width * 2, height * 2])
              .radius(radius)
              .mesh);

        svg.selectAll("circle")
            .data(_dataset)
            .enter().append("circle")
            .classed('circle', true)
            .attr("cx", function(d) { return d[0]; })
            .attr("cy", function(d) { return d[1]; })
            .attr("r", function(d) { return d[2] / 2 - .5; });
      };

      exports.width = function(_x) {
        if(!arguments.length) return width;
        width = parseInt(_x);
        return this;
      };

      exports.height = function(_x) {
        if(!arguments.length) return height;
        height = parseInt(_x);
        return this;
      };

      return exports;
    };

    //var powe = d3.custom.paddoom()();

    describe('Paddoom', function() {
      var po, sandbox, dataset;

      beforeEach(function() {
        dataset = [[250, 200, 60], [560, 300, 120], [100, 200, 200]];
        sandbox = d3.custom.paddoom();
      });

      it('should have width getter/setter', function() {
        var defaultWidth = sandbox.width();
        var defaultHeight = sandbox.height();

        sandbox.width(800);
        sandbox.height(300);

        var newWidth = sandbox.width();
        var newHeight = sandbox.height();

        expect(newWidth).toBe(800);
        expect(newHeight).toBe(300);
      });

      it('should have three charts', function() {
        sandbox(dataset);
        expect(d3.selectAll('.circle')[0].length).toBe(3);
      });
    });

  </script>

</html>